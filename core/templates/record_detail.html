{% extends 'base.html' %}

{% block content %}
<div class="py-4">

  <h1>Record {{ record_number }}</h1>
  <p class="text-muted">File: {{ rec.filename }}</p>

  <!-- PATIENT NAME -->
  <h3 class="mt-4">Patient Information</h3>
  <div class="card mb-4">
    <div class="card-body">
      <strong>Name:</strong>
      {{ rec.parsed.name_of_patient|default:"â€“" }}
    </div>
  </div>

  <!-- CHRONIC CONDITIONS -->
  <h3>Chronic Conditions</h3>
  {% if rec.parsed.chronic_conditions %}
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Condition</th>
          <th>Date Diagnosed</th>
          <th>Status</th>
          <th>Severity</th>
        </tr>
      </thead>
      <tbody>
        {% for c in rec.parsed.chronic_conditions %}
          <tr>
            <td>{{ c.name }}</td>
            <td>{{ c.date_diagnosed }}</td>
            <td>{{ c.resolved }}</td>
            <td>{{ c.severity }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-muted">No chronic conditions found.</p>
  {% endif %}

  <!-- ALLERGIES -->
  <h3 class="mt-4">Allergies</h3>
  {% if rec.parsed.allergies %}
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Allergen</th>
          <th>Type</th>
          <th>Severity</th>
          <th>Reaction</th>
        </tr>
      </thead>
      <tbody>
        {% for a in rec.parsed.allergies %}
          <tr>
            <td>{{ a.allergy }}</td>
            <td>{{ a.type }}</td>
            <td>{{ a.severity }}</td>
            <td>{{ a.reaction }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-muted">No allergies recorded.</p>
  {% endif %}

  <!-- MEDICATIONS -->
  <h3 class="mt-4">Medications</h3>
  {% if rec.parsed.medications %}
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Medication</th>
          <th>Dosage</th>
          <th>Frequency</th>
          <th>Start Date</th>
        </tr>
      </thead>
      <tbody>
        {% for m in rec.parsed.medications %}
          <tr>
            <td>{{ m.medication }}</td>
            <td>{{ m.dosage }}</td>
            <td>{{ m.frequency }}</td>
            <td>{{ m.start_date }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-muted">No medications listed.</p>
  {% endif %}

  <!-- OCR TEXT -->
  <h3 class="mt-4">OCR Extracted Text</h3>
  <pre class="ocr-box">{{ rec.ocr_text|default:"No OCR text" }}</pre>

  <a class="btn btn-secondary mt-3" href="{% url 'records' %}">Back</a>

</div>
{% endblock %}
